module Utility(empty, print, find, buy) where

import Prelude hiding(print)
import TypesMonopoly
import PlayerOperations

--------------------------------------------------------------------------------
-- interface
--------------------------------------------------------------------------------

{- Represents a fresh list of utilities where "Nobody" owns all the utilities
 -}
empty :: [Utility]

{- print name
   Prints everthing you need to know about the utility called 'name'
   SIDE-EFFECTS: Displays information about a choosen railroad
 -}
print :: Name -> IO ()

{- find (players, properties, railroads, utilities) name
   Finds the utility called 'name' in status
   PRE: 'name' is the name of a utility in status
   RETURNS: the utility called 'name' in status
   EXAMPLES: find ([],[],[("Polacksbacken","Nobody",0),("Grindstugan","Nobody",0),("Uppsala Science Park","Nobody",0),("Lundellska Skolan","Nobody",0)],[]) "Grindstugan" == ("Grindstugan","Nobody",0)
 -}
-- VARIANT: length utilities
find :: Status -> Name -> Utility


{- buy status player utilityName
   Updates the owner of utlityName
   RETURNS: 'status' where the owner of 'utiltyName' is the name of 'player'
   EXAMPLES: buy ([("Aria",1350,28,0),("Kevin",1500,15,0)],[],[],[("Electric Company","Nobody",0),("Water Works","Aria",1)]) ("Aria",1350,28,0) "Electric Company" == ([("Aria",1200,28,0),("Kevin",1500,15,0)],[],[],[("Electric Company","Aria",2),("Water Works","Aria",2)])
 -}
buy :: Status -> Player -> Name -> Status

{- currentStage utility name
   Returns the current stage of a utility
   RETURNS: How many utilities the player called 'name' currently owns
   EXAMPLE: currentStage [("Electric Company","Nobody",0),("Water Works","Aria",1)] "Aria" == 1
 -}
    -- VARIANT: length railroads
currentStage :: [Utility] -> Name -> Stage
                             
{- updateUtilities utilities namePlayer nameUtility newStage
   Updates the values of all utilities owned by 'playerName', inlcuding 'nameUtility'
   RETURNS: utilities with updated values for all utilities owned by 'playerName', inlcuding 'nameUtility'
   EXAMPLE: updateUtilities [("Electric Company","Nobody",0),("Water Works","Aria",1)] "Aria" "Electric Company" 2 == [("Electric Company","Aria",2),("Water Works","Aria",2)]
 -}
-- VARIANT: length railroads
updateUtilities :: [Utility] -> Name -> Name -> Stage -> [Utility]

-------------------------------------------------------------------------------
-- implementation
-------------------------------------------------------------------------------

empty =
  [("Electric Company","Nobody",0),
   ("Water Works",     "Nobody",0)]

print name = do
  putStrLn "..................................................."
  putStrLn $ "Utility " ++ name
  putStrLn "Price: $150"
  --All utilities cost $150
  putStrLn "Rent if the owner has 1 utility:    4*(sum of dice)"
  putStrLn "Rent if the owner has 2 utilities: 10*(sum of dice)"
  putStrLn "..................................................."

find (pla, pro, rai, (nam, own, sta):xs) name
                               | nam == name = (nam, own, sta)
                               | otherwise   = find (pla, pro, rai, xs) name

buy (pla, pro, rai, uti) (nameP, bal, pos, jai) nameR =
  updatePlayer (pla, pro, (updateUtilities rai nameP nameR (1 + currentStage rai nameP)), uti) (nameP, bal-200, pos, jai)

currentStage [] _ = 0
currentStage ((_, owner, stage):xs) nameP | owner == nameP = stage
                                          | otherwise      = currentStage xs nameP
             
updateUtilities [] _ _ _ = []
updateUtilities ((name, owner, stage):xs) nameP nameU newStage
                     | name == nameU || owner == nameP = (name, nameP, newStage) : updateUtilities xs nameP nameU newStage
                     | otherwise = (name, owner, stage) : updateUtilities xs nameP nameU newStage
